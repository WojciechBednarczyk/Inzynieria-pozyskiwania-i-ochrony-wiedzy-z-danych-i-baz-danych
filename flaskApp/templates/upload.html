<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Processor</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

<input type="file" id="fileInput" name="file">
<img id="processedImage" src="" alt="Processed Image">

<!-- Suwaki do konfiguracji ImageProcessor -->
<div>
    Otsu: <span id="otsuValue"></span>
    <input type="range" id="otsuSlider" min="0" max="1" step="1">
</div>
<div>
    Histogram: <span id="histogramValue"></span>
    <input type="range" id="histogramSlider" min="0" max="1" step="1">
</div>
<div>
    Area Threshold: <span id="areaThresholdValue"></span>
    <input type="range" id="areaThresholdSlider" min="5000" max="15000" step="100">
</div>
<div>
    Block Size: <span id="blockSizeValue"></span>
    <input type="range" id="blockSizeSlider" min="3" max="500" step="10">
</div>
<div>
    C Value: <span id="cValue"></span>
    <input type="range" id="cSlider" min="1" max="50" step="1">
</div>

<script>
$(document).ready(function() {
    // Funkcja do aktualizacji wartości suwaków
    function updateSliderValues() {
        $('#otsuValue').text($('#otsuSlider').val());
        $('#histogramValue').text($('#histogramSlider').val());
        $('#areaThresholdValue').text($('#areaThresholdSlider').val());
        $('#blockSizeValue').text($('#blockSizeSlider').val());
        $('#cValue').text($('#cSlider').val());
    }

    $('#fileInput').change(function() {
        var formData = new FormData();
        formData.append('file', $('#fileInput')[0].files[0]);
        $.ajax({
            url: '/upload',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function(data) {
                $('#processedImage').attr('src', data.image_url);
                updateSliderValues();
            },
            error: function() {
                alert('Failed to upload image.');
            }
        });
    });

    function updateImage() {
        var otsu = $('#otsuSlider').val();
        var histogram = $('#histogramSlider').val();
        var areaThreshold = $('#areaThresholdSlider').val();
        var blockSize = $('#blockSizeSlider').val();
        var cValue = $('#cSlider').val();
        var filename = $('#fileInput')[0].files[0].name;

        $.ajax({
            url: '/process',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                'filename': filename,
                'use_otsu': otsu === "1",
                'use_histogram': histogram === "1",
                'lung_contour_area_threshold': parseInt(areaThreshold),
                'adaptive_threshold_block_size': parseInt(blockSize),
                'adaptive_threshold_C': parseInt(cValue)
            }),
            dataType: 'json',
            success: function(data) {
                $('#processedImage').attr('src', data.image_url);
            },
            error: function() {
                alert('Failed to process image.');
            }
        });
    }

    // Dodanie obsługi zdarzeń dla suwaków
    $('#otsuSlider, #histogramSlider, #areaThresholdSlider, #blockSizeSlider, #cSlider').on('input change', function() {
        updateSliderValues();
        updateImage();
    });
});
</script>

</body>
</html>
